<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cryptogram Solver</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    padding: 20px;
    max-width: 1100px;
    margin: auto;
  }

  textarea {
    width: 100%;
    height: 120px;
    font-size: 16px;
  }

  .section {
    margin-top: 24px;
  }

  /* ----- Header row ----- */
  .header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  button {
    padding: 6px 12px;
    font-size: 14px;
    cursor: pointer;
  }

  /* ----- Layout ----- */
  .layout {
    display: flex;
    gap: 20px;
    align-items: flex-start;
  }

  .main-column {
    flex: 1;
  }

  .stats-column {
    width: 140px;
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 6px;
    background: #fafafa;
    text-align: center;
  }

  .stats-column h4 {
    margin: 0 0 10px;
    font-weight: 600;
  }

  /* ----- Letters Remaining ----- */
  .letters-section h4 {
    margin-bottom: 8px;
    font-weight: 600;
  }

  .letters-remaining span {
    display: inline-block;
    font-size: 20px;
    margin-right: 8px;
    font-weight: bold;
  }

  .used {
    color: #bbb;
    text-decoration: line-through;
  }

  /* ----- Stats ----- */
  .stats span {
    display: block;
    margin-bottom: 6px;
    font-family: monospace;
  }

  /* ----- Puzzle ----- */
  .puzzle {
    font-family: monospace;
    font-size: 18px;
    line-height: 2.4;
  }

  .word {
    display: inline-block;
    white-space: nowrap;
    margin-right: 10px;
  }

  .letter-cell {
    display: inline-block;
    width: 28px;
    text-align: center;
    margin: 2px;
  }

  .letter-cell input {
    width: 26px;
    text-align: center;
    font-size: 14px;
  }

  .conflict input {
    background: #ffcccc;
  }
</style>
</head>

<body>

<h1>Cryptogram Solver</h1>

<!-- Encoded Message -->
<div class="section">
  <div class="header-row">
    <h3>Encoded Message</h3>
    <button onclick="resetAll()">Reset</button>
  </div>
  <textarea id="inputText" placeholder="Paste cryptogram here..."></textarea>
</div>

<!-- Solve + Stats Layout -->
<div class="section layout">
  <div class="main-column">
    <h3>Solve</h3>
    <div class="puzzle" id="puzzle"></div>

    <div class="letters-section">
      <h4>Letters Remaining</h4>
      <div class="letters-remaining" id="lettersRemaining"></div>
    </div>
  </div>

  <div class="stats-column">
    <h4>Letter Frequency</h4>
    <div class="stats" id="stats"></div>
  </div>
</div>

<script>
const inputText = document.getElementById("inputText");
const puzzleDiv = document.getElementById("puzzle");
const statsDiv = document.getElementById("stats");
const lettersRemainingDiv = document.getElementById("lettersRemaining");

let mapping = {}; // encoded -> decoded

inputText.addEventListener("input", rebuild);

function resetAll() {
  mapping = {};
  puzzleDiv.innerHTML = "";
}

function rebuild() {
  mapping = {};
  const text = inputText.value.toUpperCase();
  buildStats(text);
  buildPuzzle(text);
  updateLettersRemaining();
}

function buildStats(text) {
  const counts = {};
  for (const ch of text) {
    if (/[A-Z]/.test(ch)) {
      counts[ch] = (counts[ch] || 0) + 1;
    }
  }

  statsDiv.innerHTML = "";
  Object.keys(counts)
    .sort()
    .forEach(letter => {
      const span = document.createElement("span");
      span.textContent = `${letter} â€” ${counts[letter]}`;
      statsDiv.appendChild(span);
    });
}

function buildPuzzle(text) {
  puzzleDiv.innerHTML = "";

  const words = text.split(/(\s+)/);

  words.forEach(word => {
    if (/^\s+$/.test(word)) {
      puzzleDiv.appendChild(document.createTextNode(word));
      return;
    }

    const wordDiv = document.createElement("div");
    wordDiv.className = "word";

    [...word].forEach(ch => {
      if (/[A-Z]/.test(ch)) {
        const cell = document.createElement("div");
        cell.className = "letter-cell";

        const input = document.createElement("input");
        input.maxLength = 1;

        input.addEventListener("input", e => {
          handleAssignment(ch, e.target.value);
        });

        const letter = document.createElement("div");
        letter.textContent = ch;

        cell.appendChild(input);
        cell.appendChild(letter);
        wordDiv.appendChild(cell);
      } else {
        const punct = document.createElement("span");
        punct.textContent = ch;
        wordDiv.appendChild(punct);
      }
    });

    puzzleDiv.appendChild(wordDiv);
  });
}

function handleAssignment(encoded, decoded) {
  decoded = decoded.toUpperCase();

  if (!decoded.match(/[A-Z]/)) {
    delete mapping[encoded];
  } else {
    mapping[encoded] = decoded;
  }

  document.querySelectorAll(".letter-cell").forEach(cell => {
    const cellEncoded = cell.lastChild.textContent;
    const input = cell.querySelector("input");

    if (cellEncoded === encoded) {
      input.value = mapping[encoded] || "";
    }
  });

  validateConflicts();
  updateLettersRemaining();
}

function validateConflicts() {
  const used = {};
  document.querySelectorAll(".letter-cell").forEach(cell => {
    cell.classList.remove("conflict");
    const encoded = cell.lastChild.textContent;
    const input = cell.querySelector("input");
    const val = input.value.toUpperCase();

    if (!val) return;

    if (used[val] && used[val] !== encoded) {
      cell.classList.add("conflict");
    } else {
      used[val] = encoded;
    }
  });
}

function updateLettersRemaining() {
  const used = new Set(Object.values(mapping));
  lettersRemainingDiv.innerHTML = "";

  for (let i = 65; i <= 90; i++) {
    const letter = String.fromCharCode(i);
    const span = document.createElement("span");
    span.textContent = letter;
    if (used.has(letter)) span.classList.add("used");
    lettersRemainingDiv.appendChild(span);
  }
}
</script>

</body>
</html>
