<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cryptogram Solver</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    padding: 20px;
    max-width: 1100px;
    margin: auto;
  }

  textarea {
    width: 100%;
    height: 120px;
    font-size: 16px;
  }

  .section {
    margin-top: 24px;
  }

  .letters-remaining span {
    display: inline-block;
    margin-right: 6px;
    font-weight: bold;
  }

  .used {
    color: #bbb;
    text-decoration: line-through;
  }

  .stats span {
    margin-right: 12px;
  }

  .puzzle {
    font-family: monospace;
    font-size: 18px;
    line-height: 2.2;
    word-wrap: break-word;
  }

  .letter-cell {
    display: inline-block;
    width: 28px;
    text-align: center;
    margin: 2px;
  }

  .letter-cell input {
    width: 26px;
    text-align: center;
    font-size: 14px;
  }

  .conflict input {
    background: #ffcccc;
  }

  .space {
    width: 12px;
    display: inline-block;
  }
</style>
</head>
<body>

<h1>Cryptogram Solver</h1>

<div class="section">
  <h3>Encoded Message</h3>
  <textarea id="inputText" placeholder="Paste cryptogram here..."></textarea>
</div>

<div class="section">
  <h3>Letters Remaining</h3>
  <div class="letters-remaining" id="lettersRemaining"></div>
</div>

<div class="section">
  <h3>Letter Frequency</h3>
  <div class="stats" id="stats"></div>
</div>

<div class="section">
  <h3>Solve</h3>
  <div class="puzzle" id="puzzle"></div>
</div>

<script>
const inputText = document.getElementById("inputText");
const puzzleDiv = document.getElementById("puzzle");
const statsDiv = document.getElementById("stats");
const lettersRemainingDiv = document.getElementById("lettersRemaining");

let mapping = {}; // encoded -> decoded

inputText.addEventListener("input", rebuild);

function rebuild() {
  mapping = {};
  const text = inputText.value.toUpperCase();
  buildStats(text);
  buildPuzzle(text);
  updateLettersRemaining();
}

function buildStats(text) {
  const counts = {};
  for (const ch of text) {
    if (/[A-Z]/.test(ch)) {
      counts[ch] = (counts[ch] || 0) + 1;
    }
  }

  statsDiv.innerHTML = "";
  Object.keys(counts)
    .sort()
    .forEach(letter => {
      const span = document.createElement("span");
      span.textContent = `${letter} - ${counts[letter]}`;
      statsDiv.appendChild(span);
    });
}

function buildPuzzle(text) {
  puzzleDiv.innerHTML = "";

  [...text].forEach(ch => {
    if (/[A-Z]/.test(ch)) {
      const cell = document.createElement("div");
      cell.className = "letter-cell";

      const input = document.createElement("input");
      input.maxLength = 1;

      input.addEventListener("input", e => {
        const val = e.target.value.toUpperCase();
        handleAssignment(ch, val);
      });

      const letter = document.createElement("div");
      letter.textContent = ch;

      cell.appendChild(input);
      cell.appendChild(letter);
      puzzleDiv.appendChild(cell);
    } else if (ch === " ") {
      const space = document.createElement("div");
      space.className = "space";
      puzzleDiv.appendChild(space);
    } else {
      const punct = document.createElement("span");
      punct.textContent = ch;
      puzzleDiv.appendChild(punct);
    }
  });
}

function handleAssignment(encoded, decoded) {
  if (!decoded.match(/[A-Z]/)) {
    delete mapping[encoded];
  } else {
    mapping[encoded] = decoded;
  }

  validateConflicts();
  updateLettersRemaining();
}

function validateConflicts() {
  const used = {};
  document.querySelectorAll(".letter-cell").forEach(cell => {
    cell.classList.remove("conflict");
    const encoded = cell.lastChild.textContent;
    const input = cell.querySelector("input");
    const val = input.value.toUpperCase();

    if (!val) return;

    if (used[val] && used[val] !== encoded) {
      cell.classList.add("conflict");
    } else {
      used[val] = encoded;
    }
  });
}

function updateLettersRemaining() {
  const used = new Set(Object.values(mapping));
  lettersRemainingDiv.innerHTML = "";

  for (let i = 65; i <= 90; i++) {
    const letter = String.fromCharCode(i);
    const span = document.createElement("span");
    span.textContent = letter;
    if (used.has(letter)) span.classList.add("used");
    lettersRemainingDiv.appendChild(span);
  }
}
</script>

</body>
</html>
